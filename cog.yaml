build:
  cog_runtime: true
  gpu: true
  cuda: "12.4"
  python_version: "3.10"
  python_requirements: "requirements.txt"
  run:
    # 安装系统依赖
    - apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends libegl1-mesa-dev libglib2.0-0 libeigen3-dev libcgal-dev libxi6 libgconf-2-4 libxkbcommon-x11-0 libsm6 libxext6 libxrender-dev libglvnd0 libgl1 libglx0 libegl1 libgles2 libglvnd-dev libgl1-mesa-dev libegl1-mesa-dev libgles2-mesa-dev mesa-utils-extra libxrender1 && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

    # 升级 pip 和安装基础 Python 工具
    - python3.10 -m pip install --upgrade pip setuptools wheel

    # 安装 PyTorch + CUDA
    - python3.10 -m pip install torch==2.5.1 torchvision==0.20.1 torchaudio==2.5.1 --index-url https://download.pytorch.org/whl/cu124

    # 安装 modelscope 及依赖
    - python3.10 -m pip install modelscope kornia>=0.7.0 pillow>=9.0.0

    # 安装 bpy
    - python3.10 -m pip install bpy==4.0 --extra-index-url https://download.blender.org/pypi/

    # 下载 RealESRGAN ckpt
    - mkdir -p /root/.cache/hy3dpaint/ckpt && curl -o /root/.cache/hy3dpaint/ckpt/RealESRGAN_x4plus.pth -L "https://github.com/xinntao/Real-ESRGAN/releases/download/v0.1.0/RealESRGAN_x4plus.pth"

    # 下载 u2net
    - mkdir -p /root/.u2net/ && curl -o /root/.u2net/u2net.onnx -L "https://github.com/danielgatis/rembg/releases/download/v0.0.0/u2net.onnx"

    # RMBG-2.0 模型缓存
    - python3.10 -c "from modelscope import AutoModelForImageSegmentation; AutoModelForImageSegmentation.from_pretrained('AI-ModelScope/RMBG-2.0', trust_remote_code=True)"

predict: "predict.py:Predictor" 
